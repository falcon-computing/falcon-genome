#!/bin/bash

SCRIPT_DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )

if [ "$#" -lt 1 ]; then
  echo "Missing command"
  exit -1;
fi

source $SCRIPT_DIR/manager/config.mk
LD_LIBRARY_PATH=$BOOST_LIB:$LD_LIBRARY_PATH
LD_LIBRARY_PATH=$GLOG_DIR/lib:$LD_LIBRARY_PATH
LD_LIBRARY_PATH=$GFLAGS_DIR/lib:$LD_LIBRARY_PATH

output=`$SCRIPT_DIR/manager/client`

if [ $? -ne 0 ]; then
  echo "Cannot connect to manager, exiting..."
  exit 1
fi

output_arr=($output)
host=${output_arr[0]}
pid=${output_arr[1]}

# launch process
set -x
if [ -e "$1" ]; then
  ssh $host 'bash -s' < $1
else
  ssh $host $1
fi
set +x

$SCRIPT_DIR/manager/client $pid
